<!DOCTYPE HTML>
<html>
<head>
  <meta charset='UTF-8'>
  <title>Умное окно - старт</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel="stylesheet" href="ys1.css" />
</head>
<body>
  <div class='content'>
  <details>
  <summary>Умное окно</summary>
  <div class='info'>
  <p>Температура 1: <span id='temp1'>?</span></p>
  <p>Температура 2: <span id='temp2'>?</span></p>
  <p>Уровень воды: <span id='waterLevel'>?</span></p>
  <p>Режим: <span id='currentState'>?</span></p>
  <p>Время пролива: <span id='passTime'>?</span></p>
  <p>Расход: <span id='waterStreamValue'>?</span></p>
  <p>Свободная память: <span id='freeValue'>?</span></p>
  </div>
</details>
  <p>Выберите режим:</p>
  <div id="temperatureMode">
<input type="radio" id="temperatureTarget" name="mode" value="temperatureTarget" onchange="switchMode(this);" checked>
<label for="temperatureValue">Целевая температура:</label>
<input type="range" id="temperatureValue" name="temperatureValue" min="10" max="30" step="1" list="temperatureOptions" onchange="document.getElementById('selectedTemperatureValue').innerHTML=this.value;">
<span id="selectedTemperatureValue">20</span><span>&deg;C</span></p>
<datalist id="temperatureOptions">
  <option value="10">10</option>
  <option value="15">15</option>
  <option value="20">20</option>
  <option value="25">25</option>
  <option value="30">30</option>
</datalist>
</div>
<div id="periodMode">
<input type="radio" id="periodTarget" name="mode" value="periodTarget" onchange="switchMode(this);">
<label for="periodValue">Период открывания:</label>
<input type="range" id="periodValue" name="periodValue" min="0" max="60" step="1" list="periodOptions" onchange="document.getElementById('selectedPeriodValue').innerHTML=this.value;" disabled>
<span id="selectedPeriodValue">30</span><span> мин</span></p>
<datalist id="periodOptions">
  <option value="0">0</option>
  <option value="10">10</option>
  <option value="20">20</option>
  <option value="30">30</option>
  <option value="40">40</option>
  <option value="50">50</option>
  <option value="60">60</option>
</datalist>
<label for="angleValue">Угол открывания:</label>
<input type="range" id="angleValue" name="angleValue" min="0" max="90" step="1" list="angleOptions" onchange="document.getElementById('selectedAngleValue').innerHTML=this.value;" disabled>
<span id="selectedAngleValue">45</span><span>&deg;</span></p>
<datalist id="angleOptions">
  <option value="0">0</option>
  <option value="10">10</option>
  <option value="20">20</option>
  <option value="30">30</option>
  <option value="40">40</option>
  <option value="50">50</option>
  <option value="60">60</option>
  <option value="70">70</option>
  <option value="80">80</option>
  <option value="90">90</option>
</datalist>
</div>
<div class='card' id="ONbutton" onclick="enableMode();">
	<span><a href="#">Включить</a></span>
</div>
</div>
</body>
<script>
if (!!window.EventSource) {
 var src = new EventSource('/events');
 src.addEventListener('values', function(e) {
  var res = String(e.data).split('¿');
  setVal('temp1', res[0]);
  setVal('temp2', res[1]);
  setVal('waterLevel', res[2]);
  setVal('currentState', res[3]);
  setVal('passTime', res[4]);
  setVal('waterStreamValue', res[5]);
  setVal('freeValue', res[6]);
 }, false); 
}

function setVal(id, val) {
  document.getElementById(id).innerHTML = val;
}

function switchMode(target) {
	//alert(target.id);
	if(target.id=='temperatureTarget') {
		document.getElementById('periodValue').disabled=true;
		document.getElementById('angleValue').disabled=true;
		document.getElementById('temperatureValue').disabled=false;
	}
	else {
		document.getElementById('temperatureValue').disabled=true;
		document.getElementById('periodValue').disabled=false;
		document.getElementById('angleValue').disabled=false;
	}
	document.getElementById('ONbutton').disabled=false;
}

function enableMode() {
	var qs='/updatedata?output1=';
	if(document.getElementById('temperatureTarget').checked) {
		qs+='temperatureValue'+'&state1='+document.getElementById('temperatureValue').value;
	}
	else {
		qs+='periodValue'+'&state1='+document.getElementById('periodValue').value+'&output2=angleValue&state2='+document.getElementById('angleValue').value;
	}
	alert(qs);
	//var xhr = new XMLHttpRequest();
	//xhr.open('GET', '/updatedata?output1='+qs, true);
	//xhr.send();
}
</script>
</html>